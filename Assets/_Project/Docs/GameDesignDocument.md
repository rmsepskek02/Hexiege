# Hexiege - 게임 기획서 (Game Design Document)

**버전:** 0.5.0
**최종 수정일:** 2026-02-14
**작성자:** HANYONGHEE

---

## 📋 목차

1. [게임 개요](#게임-개요)
2. [핵심 게임플레이](#핵심-게임플레이)
3. [건물 시스템](#건물-시스템)
4. [유닛 시스템](#유닛-시스템)
5. [종족 시스템](#종족-시스템)
6. [타일 시스템](#타일-시스템)
7. [승리 조건](#승리-조건)
8. [생산 시스템](#생산-시스템)
9. [수익화 전략](#수익화-전략)
10. [개발 우선순위](#개발-우선순위)

---

## 🎮 게임 개요

### 기본 정보
- **장르**: 실시간 전략 게임 (RTS)
- **플랫폼**: 모바일 (Android/iOS)
- **화면 방향**: 세로 모드 (Portrait)
- **플레이 모드**: PvP 1v1 실시간 매칭
- **평균 플레이 타임**: 10분 (서든데스 2분 포함, 최대 12분)

### 핵심 컨셉
육각형 타일맵 기반의 공성전 RTS 게임. 플레이어는 건물을 건설하고 유닛을 생산하여 상대방의 본기지를 파괴하는 것이 목표입니다. 유닛은 AI로 자동 제어되며, 플레이어는 전략적 건물 배치와 생산 관리에 집중합니다.

### 차별화 포인트
- 육각형 타일 기반 공간 전략
- 타일 점령 = 인구수 확장 메커니즘
- 자동/수동 생산 하이브리드 시스템
- 3종족 고유 특성

### 비주얼 스타일
- **그래픽**: 2D 캐주얼
- **아트 방향**: 밝고 친근한 느낌
- **뷰**: 탑다운 2D

### 카메라 시스템
- **기본 뷰**: 고정 각도 탑다운
- **화면 이동**: 한 손가락 드래그 (Pan)
- **확대/축소**: 두 손가락 핀치 (Zoom)
- **줌 범위**: 최소 0.5x ~ 최대 2.0x (조정 가능)
- **이동 제한**: 맵 경계 내로 제한

---

## 🎯 핵심 게임플레이

### 게임 흐름
```
게임 시작
  ↓
초기 타일 할당 (7~10개)
  ↓
자원 수집 (자원 건물 건설)
  ↓
유닛 생산 (생산 건물 + 랠리 설정)
  ↓
타일 점령 확장 (인구수 증가)
  ↓
전선 관리 (방어타워, 마법)
  ↓
업그레이드 투자
  ↓
상대 본기지 공격
  ↓
승리!
```

### 플레이어 행동
1. **건물 건설**: 타일 선택 → 건물 타입 선택 → 건설
2. **유닛 생산**: 생산 건물 선택 → 유닛 타입 설정 (자동/수동)
3. **랠리 포인트**: 생산 건물 → 타일 지정
4. **마법 사용**: 마법 건물 → 마법 선택 → 타겟 지정
5. **건물 업그레이드**: 건물 선택 → 업그레이드 버튼

### 인구수 시스템
**공식**: `총 인구수 = 보유 타일 수`

**인구 소비**:
- 건물: 각 1 인구
- 유닛: 각 1 인구

**예시**:
```
보유 타일: 20개
건물: 본기지(1) + 생산건물(3) + 타워(1) = 5개
사용 가능 인구: 20 - 5 = 15마리 유닛
```

> **구현 현황:** `PopulationUseCase`가 `HexGrid.CountTilesOwnedBy()`로 최대 인구를, 유닛+건물 수로 사용 인구를 실시간 계산.

### 자원 시스템
**골드 (인게임 자원)**:
- 시작 골드: 500
- 채굴소(MiningPost) 건설 시 초당 10 골드 수입
- 건물 건설/유닛 생산에 소비

**건물 비용**:
| 건물 | 비용 |
|------|------|
| 배럭 (Barracks) | 100 골드 |
| 채굴소 (MiningPost) | 50 골드 |

**유닛 생산 비용**:
| 유닛 | 비용 | 생산 시간 | 인구 |
|------|------|-----------|------|
| 권총병 (Pistoleer) | 50 골드 | 5초 | 1 |

> **구현 현황:** `ResourceUseCase`가 팀별 골드를 관리. 건물 배치 시 골드 차감 검증, 유닛 생산 시 골드+인구 검증 후 차감.

---

## 🏗️ 건물 시스템

### 1. 유닛 생산 건물 (Barracks)
**기능**:
- 유닛 생산 (자동/수동)
- 랠리 포인트 설정
- 건물 업그레이드

**업그레이드 효과**:
- Lv1: 기본 유닛 생산
- Lv2: 유닛 진화 (스탯 증가)
- Lv3: 상위 유닛 해금

**비용**: 100 골드

> **구현 현황:** 배럭 클릭 → 생산 패널 UI 표시 → 유닛 탭(수동 큐)/롱프레스(자동 생산) → 랠리포인트 설정 가능.

---

### 2. 자원 건물 (Resource Collector)
**기능**:
- 자원 오브젝트 위에 건설
- 자동 자원 수집
- 건물 업그레이드

**업그레이드 효과**:
- Lv1: +10 골드/초
- Lv2: +15 골드/초
- Lv3: +20 골드/초

**비용**: 50 골드

---

### 3. 마법 건물 (Magic Tower)
**기능**:
- 액티브 스킬 사용
- 쿨다운 관리
- 건물 업그레이드

**마법 종류**:
- **번개 공격**: 단일 타겟 높은 데미지
- **지역 회복**: 범위 내 아군 체력 회복
- **버프**: 공격력/방어력 증가
- **디버프**: 이동속도/공격속도 감소

**업그레이드 효과**:
- 마법 위력 증가
- 쿨다운 감소
- 범위 확대

**비용**: 150 골드

---

### 4. 방어 타워 (Defense Tower)
**기능**:
- 자동 공격 (고정 위치)
- 사거리 내 적 자동 타게팅
- 건물 업그레이드

**업그레이드 효과**:
- 공격력 증가
- 사거리 증가
- 공격속도 증가

**비용**: 100 골드

---

### 5. 업그레이드 건물 (Research Lab)
**기능**:
- 전역 유닛/마법 강화
- 건물 업그레이드

**연구 항목**:
- 유닛 공격력 +10%
- 유닛 체력 +10%
- 유닛 이동속도 +10%
- 마법 위력 +20%

**업그레이드 효과**:
- 각 연구 레벨 상한 증가 (Max Lv5 → Lv10)

**비용**: 200 골드

---

### 본기지 (Main Base)
**기능**:
- 체력: 5000 HP
- 수리: 골드 소모로 체력 회복
- 약한 기본 공격력 (방어용)

**업그레이드 (선택적)**:
- Lv2: 체력 +1000
- Lv3: 수리 효율 증가
- Lv4: 방어 공격력 증가
- Lv5: 근처 아군 버프

---

## 🪖 유닛 시스템

### 유닛 특성
- **AI 자동 제어**: 플레이어는 직접 조작 불가
- **자동 이동**: 랠리 포인트로 이동
- **자동 공격**: 사거리 내 적 발견 시 공격
- **타일 점령**: 이동한 타일을 자동 점령

### 유닛 생성 흐름
```
생산 건물에서 생성
  ↓
랠리 포인트로 자동 이동
  ↓
아군 타일 점유/선점 시 인접 타일로 우회
  ↓
이동 중 사거리 내 적 발견 → 즉시 전투
  ↓
전투 승리 → 타일 중앙 도착 = 점령
  ↓
적 처치 or 사망
```

### 유닛 타입 예시 (종족별 상이)
**인간계**:
- **권총병** (5초): 빠른 생산, 낮은 스탯
- **기관총병** (10초): 균형잡힌 스탯
- **저격총병** (15초): 높은 공격력, 긴 사거리

**정령계**:
- **불 정령** (7초): 근접 높은 데미지
- **물 정령** (10초): 중거리 지속 데미지
- **전기 정령** (12초): 광역 체인 공격

**초월계**:
- **곰 전사** (10초): 높은 체력, 탱커
- **여우 마법사** (15초): 마법 공격, 서포터
- **사자 기사** (12초): 높은 공격력, 돌진

---

## 🌍 종족 시스템

### 인간계 (Human)
**컨셉**: 중세~현대 무기 기반 군대

**유닛 예시**:
- 검사, 창병, 궁수
- 권총병, 기관총병, 저격수
- 기병, 탱크

**종족 특성**:
- 균형잡힌 스탯
- 생산 속도 +10%
- 범용성 높음

---

### 정령계 (Elemental)
**컨셉**: 9가지 원소 정령

**속성**:
- 불, 물, 대지, 빛, 어둠, 바람, 전기, 숲

**유닛 예시**:
- 불 정령: 근접 폭발 데미지
- 물 정령: 중거리 슬로우
- 전기 정령: 체인 라이트닝
- 빛 정령: 힐링
- 어둠 정령: 디버프

**종족 특성**:
- 마법 위력 +15%
- 속성 상성 시스템 (추후 확장)
- 유닛 체력 -10%

---

### 초월계 (Transcendent)
**컨셉**: 의인화된 동식물

**유닛 예시**:
- 곰 전사: 탱커
- 사자 기사: 딜러
- 여우 마법사: 서포터
- 나무 수호자: 방어
- 꽃 힐러: 힐링

**종족 특성**:
- 유닛 체력 +15%
- 재생 능력 (초당 1% 회복)
- 이동속도 -5%

---

## 🗺️ 타일 시스템

### 육각형 타일
**좌표계**: Cube Coordinates (q, r, s)
```
  / \
 |   |
  \ /
```

**타일 상태**:
1. **중립 (Neutral)**: 회색
2. **파랑 진영 (Blue)**: 파랑색
3. **빨강 진영 (Red)**: 빨강색

### 타일 점령 규칙
**점령 조건**:
- 유닛이 타일 위로 이동 → 즉시 해당 진영 색상으로 변경
- 건물 건설 시 인접 6타일이 건물 팀으로 자동 점령 (영토 확장)

**타일 탈환**:
- 적 타일에 유닛 진입 시 빼앗기

**타일 중립화**:
- 점령한 타일에 오브젝트 없음
- 인접한 아군 타일 없음
- 위 조건 충족 시 **10초 후 중립화**

### 타일 점유 규칙
**이동 불가 타일**:
- 건물이 있는 타일 (`IsWalkable = false`)
- 다른 유닛이 있는 타일 (아군/적군 무관)
- **같은 팀** 유닛이 이동 중 선점한 타일 (ClaimedTile)

**적 팀 타일 경합**:
- 적 유닛의 ClaimedTile은 차단하지 않음 → 같은 타일에 적이 진입 가능
- 같은 타일에 적 유닛이 만나면 **전투**로 해결
- 타일 중앙 도착 = 전투 승리 = 점령 (패배 시 도달 불가)

**유닛 생성 불가 타일**:
- 건물이 있는 타일
- 이미 유닛이 점유 중인 타일 (아군/적군 무관)

> 경로탐색(A*) 시 모든 다른 유닛의 Position + 같은 팀 ClaimedTile이 차단 목록에 포함됩니다. 적 팀 ClaimedTile은 차단하지 않아 적과의 타일 경합이 자연스럽게 발생합니다.
> 또한 이동 중 각 스텝마다 다음 타일의 가용성을 실시간 검증하여, 경로 계산 이후 같은 팀 유닛이 해당 타일을 점유/선점한 경우 자동으로 재탐색합니다.

### 맵 크기 (프로토타입)

두 가지 타일 방향을 런타임에서 전환 가능:

| 방향 | 크기 (가로×세로) | 타일 모양 |
|------|-----------------|----------|
| **FlatTop** (기본) | 10×29 | 변이 12시 방향 |
| PointyTop | 7×17 | 꼭지점이 12시 방향 |

- **구역 구성**:
  - 적 본기지 구역 (3줄)
  - 중립 자원 구역 (5줄)
  - 전투 구역 (6줄)
  - 아군 본기지 구역 (3줄)

---

## 🏆 승리 조건

### 주 승리 조건
**본기지 파괴**: 언제든 즉시 승리

### 타임라인
```
[0:00 ~ 10:00] 일반 페이즈
- 승리: 본기지 파괴만 가능

[10:00] 체크포인트
- 타일 70% 점령 시 즉시 승리
- 미달 시 서든데스 돌입

[10:00 ~ 12:00] 서든데스 페이즈
- UI 효과: 화면 테두리 빨간 펄스
- BGM 변화
- 승리: 본기지 파괴 또는 타일 70% 점령

[12:00] 강제 종료
- 승리 조건 (우선순위):
  1. 타일 점령 수가 많은 쪽
  2. 본기지 체력이 높은 쪽
  3. 보유 자원이 많은 쪽
  4. 유닛 킬 수가 많은 쪽
```

### UI 표시
- **상단 HUD**: 타일 점유율 게이지 (파랑 vs 빨강)
- **10분 경고**: "서든데스 30초 전!"
- **서든데스**: 화면 효과 + BGM 변화

---

## ⚙️ 생산 시스템

### 자동 생산 (Auto Production)
**활성화**:
- 유닛 아이콘 **롱프레스** (0.5초)
- UI 피드백: 테두리 회전 효과 (✨)

**작동**:
- 설정된 유닛들을 **순차 반복**
- 예: 권총병(✨) + 저격수(✨) → 권총병 → 저격수 → 반복
- 인구수 부족 시 대기

**취소**:
- 수동 생산 시작 시 자동으로 취소

---

### 수동 생산 (Manual Production)
**활성화**:
- 유닛 아이콘 **탭** (짧게 누름)

**작동**:
- 생산 큐에 추가 (최대 3개 — 현재 생산 중 1 + 대기 2)
- 큐 첫 번째부터 순차 생산
- **수동 생산 시작 시**:
  1. 현재 자동생산 중이던 유닛 즉시 취소 (골드 환불 없음)
  2. 모든 자동생산 설정 해제
  3. 수동 큐 생산 시작

**큐 소진**:
- 큐가 비면 생산 중지 (자동 재개 안 함)

### 생산 타이머

- 골드/인구 조건 충족 시 즉시 골드 차감 후 생산 시작 (스폰 타일 미확인)
- 타이머 완료 시 배럭 인접 빈 타일에 유닛 스폰 시도
- **스폰 불가 시** (인접 타일이 모두 점유): 생산 완료 상태에서 대기 (Progress 1.0 유지), 매 프레임 재시도
- 스폰 성공 후 다음 생산 시작

### 랠리 포인트

- 생산 UI에서 랠리포인트 버튼 클릭 → 타일 지정 모드 → 팝업 닫힘
- 유닛 스폰 완료 시 랠리포인트가 설정되어 있으면 자동 이동 명령
- 랠리포인트 타일이 점유 중이면 BFS로 가장 가까운 빈 타일(최대 3칸)까지 이동
- **배럭 자신의 타일에 랠리포인트 설정 → 랠리포인트 해제**

**마커 표시 규칙**:
- 랠리포인트 설정 직후 3초간 마커 표시 → 자동 숨김
- 배럭 선택(팝업 열림) 시 마커 재표시
- 팝업 닫힘 / 다른 오브젝트 클릭 시 마커 숨김
- 배럭 파괴 시 마커 제거

---

### 생산 UI 예시
```
[배럭 Lv.2]
┌────────────────────────────┐
│  ┌────┐  ┌────┐  ┌────┐   │
│  │권총│  │기관│  │저격│   │
│  │ 5s │  │10s │  │15s │   │
│  └────┘  └────┘  └────┘   │
│   ✨ON              ✨ON    │
│                            │
│  생산 큐: [기관][기관][  ] │
│  ⏱ ████████░░ 8/10초       │
│                            │
│  인구: 12/15  골드: 450    │
└────────────────────────────┘
```

---

## 💰 수익화 전략 (BM)

### 핵심 원칙
**Non-P2W**: 과금은 게임 승패에 영향 없음

### 수익화 3축

#### 1. 광고
**보상형 광고**:
- 패배 후 부활 기회 (1회/경기)
- 일일 무료 상자 2배 보상
- 경험치 부스터 (1시간)

**전면 광고**:
- 경기 종료 후 (승리 시 Skip 가능)

**배너 광고**:
- 로비 하단 고정

---

#### 2. 인앱 결제
**상품 구성**:
```
• 스타터 팩 ($4.99): 종족 1개 + 골드 + 광고제거 7일
• 배틀패스 ($4.99/시즌): 진행 보상 (스킨, 이모트)
• 종족 해금 ($2.99/개)
• 프리미엄 스킨 ($0.99~$4.99)
• 광고 제거 ($9.99): 영구
```

**판매 항목 (스탯 영향 없음)**:
- ✅ 종족 스킨
- ✅ 건물 스킨
- ✅ 유닛 이펙트
- ✅ UI 테마
- ✅ 이모트
- ✅ 프로필 프레임
- ❌ 스탯 증가 아이템
- ❌ 자원 직접 구매

---

#### 3. 게임 내 화폐
**골드 (소프트)**:
- 획득: 경기 승리, 일일 임무
- 용도: 일반 상자

**크리스탈 (하드)**:
- 획득: 결제, 배틀패스, 랭크 보상
- 용도: 종족 해금, 프리미엄 스킨

---

### 컬렉션 시스템
**카드 수집 (Clash Royale 스타일)**:
- 경기 후 상자 획득
- 상자 등급: 나무 → 은 → 금 → 마법
- 카드로 유닛/건물 레벨업 (스탯 증가)
- **단, 랭크 매칭에서 카드 레벨 제한 (±2)**

---

## 📅 개발 우선순위

### Phase 1: MVP (4~6주)
```
✅ 육각형 그리드 + 타일 점령
✅ 종족 1개 (인간계) + 유닛 3종
✅ 건물 3종 (생산/자원/본기지)
✅ AI 이동/공격
✅ 로컬 1v1 테스트
```

### Phase 2: 네트워크 (3~4주)
```
✅ Netcode + Unity Relay
✅ 매칭 시스템
✅ 승리 조건
✅ 종족 2개 추가
✅ 5가지 건물 완성
```

### Phase 3: 컨텐츠 (4주)
```
✅ 카드 수집
✅ 상자/보상
✅ 광고 통합
✅ 인앱 결제
✅ UI/UX 폴리싱
```

### Phase 4: 출시 (2~3주)
```
✅ 튜토리얼
✅ 랭크 시스템
✅ 일일 임무
✅ QA 테스트
```

**총 개발 기간**: 약 3~4개월

---

## 📝 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|-----------|
| 0.5.0 | 2026-02-15 | 랠리포인트 시스템 개선: 마커 표시 규칙(3초 자동 숨김, 팝업 연동), 배럭 타일 설정→해제, BFS 빈 타일 탐색(최대 3칸), 팝업 설정 후 자동 닫힘 |
| 0.4.1 | 2026-02-14 | Per-step 타일 가용성 체크 추가: 이동 중 각 스텝마다 같은 팀 차단 실시간 검증, 차단 시 자동 재탐색 |
| 0.4.0 | 2026-02-14 | 유닛 이동/전투 규칙 개선: ClaimedTile(같은 팀 이동 중 선점, 적 팀 투과), 이동 중 거리 기반 전투(타일 중앙 도착 전 전투 발동), 타일 중앙 도착=전투 승리=점령 규칙, 적 타일 경합 규칙 추가 |
| 0.3.0 | 2026-02-14 | 생산 시스템 구현 반영: 자원 시스템(골드, 건물/유닛 비용), 인구수 시스템(타일 기반 계산), 수동/자동 생산(큐 최대 3, 롱프레스 자동), 생산 타이머(스폰 대기 로직), 랠리포인트 자동 이동, 타일 점유 규칙(아군/적군 무관 이동/생성 차단), 영토 확장(건물 건설 시 인접 타일 점령) |
| 0.2.0 | 2026-02-08 | 맵 크기 듀얼 Orientation 반영 (FlatTop 10×29 기본, PointyTop 7×17) |
| 0.1.1 | 2026-01-27 | 비주얼 스타일, 카메라 시스템 추가 |
| 0.1.0 | 2026-01-27 | 초기 문서 작성 |

---

**문서 끝**
